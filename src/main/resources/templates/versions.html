<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Versiones - ' + ${drawTitle}">Versiones del Dibujo</title>
    <link rel="stylesheet" href="/css/versions.css">
</head>
<body>
<div class="container">
    <a href="/gallery/private" class="back-link">← Volver a la galería</a>

    <h1 th:text="${drawTitle}">Título del Dibujo</h1>
    <p style="color: #7f8c8d; margin-bottom: 30px;">
        Total de versiones: <span th:text="${#lists.size(versions)}">0</span>
    </p>

    <div th:if="${#lists.isEmpty(versions)}" style="text-align: center; padding: 40px; color: #7f8c8d;">
        <p>No hay versiones disponibles para este dibujo.</p>
    </div>

    <div th:each="version, iterStat : ${versions}" class="version-item">
        <div class="version-header">
            <div>
                <span class="version-number">Versión <span th:text="${version.version_number}">1</span></span>
                <span th:if="${iterStat.first}" class="latest-badge">ÚLTIMA</span>
            </div>
            <div class="version-date" th:text="${#dates.format(version.created_at, 'dd/MM/yyyy HH:mm')}">
                01/01/2024 12:00
            </div>
        </div>

        <div class="version-actions">
            <a th:href="@{/view/{drawId}/version/{versionNum}(drawId=${drawId}, versionNum=${version.version_number})}"
               class="btn btn-view">
                Ver esta versión
            </a>

            <a th:href="@{/draw/{drawId}/version/{versionNum}(drawId=${drawId}, versionNum=${version.version_number})}"
               class="btn btn-edit">
                Editar desde esta versión
            </a>

            <button class="btn btn-clone"
                    th:onclick="'cloneVersion(' + ${drawId} + ', ' + ${version.version_number} + ')'">
                Crear copia
            </button>

            <span th:if="${iterStat.first}" style="color: #2ecc71; font-size: 0.9em;">
                    Esta es la versión más reciente
                </span>
        </div>
    </div>
</div>

<script>
    function cloneVersion(drawId, versionNumber) {
        const title = prompt('Introduce un título para la copia del dibujo (opcional):');

        if (title === null) {
            return;
        }

        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/draw/${drawId}/version/${versionNumber}/clone`;

        if (title && title.trim() !== '') {
            const titleInput = document.createElement('input');
            titleInput.type = 'hidden';
            titleInput.name = 'title';
            titleInput.value = title.trim();
            form.appendChild(titleInput);
        }

        document.body.appendChild(form);
        form.submit();
    }
</script>
</body>
</html>