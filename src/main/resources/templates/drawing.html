<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>Drawing Editor</title>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"/>
</head>
<body>
<div class="page-container">
    <nav class="sidebar">
        <a href="/draw/new" class="brand">Drawings</a>
        <div class="user-info">
            <span>Bienvenido, <span th:text="${username}"></span></span>
        </div>
        <a href="/gallery/private">Gallery</a>
        <a href="/gallery/public">Public Gallery</a>
        <a href="/logout">Logout</a>
    </nav>

    <main class="main-content">
        <div th:if="${editingVersion != null}" style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 15px; margin: 10px 20px; border-radius: 5px;">
            <strong>⚠️ Editando desde la versión <span th:text="${editingVersion}">X</span></strong>
            <p style="margin: 5px 0 0 0; font-size: 0.9em;">
                Al guardar, se creará una nueva versión basada en esta versión anterior.
                Los cambios realizados después de esta versión se mantendrán en el historial.
            </p>
        </div>

        <div class="main-container">
            <div class="canvas-container">
                <canvas id="drawingCanvas"></canvas>
            </div>
            <div class="controls-container">
                <button id="circleBtn" class="button-link">Círculo</button>
                <button id="squareBtn" class="button-link">Cuadrado</button>
                <button id="triangleBtn" class="button-link">Triángulo</button>
                <button id="starBtn" class="button-link">estrella</button>
                <button id="freeDrawBtn" class="button-link">Dibujo Libre</button>
                <input type="text" id="colorPicker" data-coloris value="#000000">
                <input type="range" id="sizePicker" min="1" max="50" value="5">
                <button id="clearBtn" class="button-link">Limpiar</button>
                <input type="text" id="drawTitleInput" th:value="${drawTitle}" placeholder="Título del dibujo">
                <input type="checkbox" name="" id="isPublicCheckbox" th:checked="${isPublic}"> Público
                <br>
                <input type="checkbox" name="autoSave" id="autoSaveCheckbox" checked> Auto-Guardado (cada 30s)
                <button id="saveButton" class="button-link">Guardar</button>
                <div id="objectList"></div>
            </div>
        </div>
    </main>
</div>

<!-- Variables del servidor para JavaScript -->
<script th:inline="javascript">
    /*<![CDATA[*/
    window.serverData = {
        drawId: /*[[${drawId}]]*/ null,
        drawTitle: /*[[${drawTitle}]]*/ 'Nuevo Dibujo',
        isPublic: /*[[${isPublic}]]*/ false,
        initialDrawContent: /*[[${initialDrawContent}]]*/ '[]',
        canEdit: /*[[${canEdit}]]*/ true,
        editingVersion: /*[[${editingVersion}]]*/ null
    };
    /*]]>*/
</script>

<script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
<script src="/js/color.js"></script>
<script src="/js/drawing.js"></script>
<script src="/js/konami.js"></script>
<script src="/js/save.js"></script>

<!-- Script para cargar el contenido inicial -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            if (window.loadDrawing && window.serverData.initialDrawContent) {
                console.log('Cargando contenido inicial:', window.serverData.initialDrawContent);
                window.loadDrawing(window.serverData.initialDrawContent);
            }
        }, 100);
    });
</script>

</body>
</html>